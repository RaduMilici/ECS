var app=angular.module("App",["ui.router"]);app.config(["$stateProvider","$urlRouterProvider",function(t,e){var n="/partials",i=n+"/templates";e.otherwise("/main"),t.state("main",{url:"/main",templateUrl:i+"/main.html",controller:"mainCtrl"})}]),angular.module("App").factory("Project",["Loader","Animator",function(t,e){return function(){this.loader=new t,this.animate=new e({project:this}),this.loader.LoadPrefab("Cube"),this.animate.Start()}}]),angular.module("App").factory("Component",[function(){return function(){this.name="",this.meshes=[],this.Start=function(){},this.Stop=function(){},this.Destroy=function(){},this.Update=function(){}}}]),angular.module("App").factory("Rotate",["Component",function(t){return function(e){t.call(this),this.velocity=new THREE.Vector3,this.prefab=e,this.Start=function(t){this.velocity=t||this.velocity},this.Update=function(t){this.prefab.rotation.x+=this.velocity.x*t,this.prefab.rotation.y+=this.velocity.y*t,this.prefab.rotation.z+=this.velocity.z*t}}}]),angular.module("App").controller("mainCtrl",["$scope","Project",function(t,e){new e}]),angular.module("App").factory("Cube",["Prefab","util",function(t,e){return function(){t.call(this),this.name="Cube",this.id="",this.layer="",this.meshes=["cube"],this.components=["Rotate"],this.uid=_.uniqueId();this.Start=function(t){this.position.z-=15,t.LoadMesh("cube").then(function(t){t.position.y+=5,t.AddComponent("Rotate"),t.components.Rotate.velocity.x=e.Deg2Rad(1),t.components.Rotate.velocity.y=e.Deg2Rad(1),t.components.Rotate.velocity.z=e.Deg2Rad(1),this.add(t)}.bind(this)),this.components.Rotate.velocity.x=e.Deg2Rad(1),this.components.Rotate.velocity.y=e.Deg2Rad(1),this.components.Rotate.velocity.z=e.Deg2Rad(1)},this.Stop=function(){},this.Destroy=function(){},this.Update=function(){}}}]),angular.module("App").factory("Prefab",[function(){return function(){THREE.Object3D.call(this),this.name="",this.id="",this.layer="",this.meshes=[],this.components=[],this.uid=_.uniqueId(),this.Start=function(){},this.Stop=function(){},this.Destroy=function(){},this.Update=function(){},this.AddComponent=function(t){this.loader.injector.AddComponent(this,t)}}}]),angular.module("App").factory("Animator",["Renderer",function(t){return function(e){function n(){return new THREE.PerspectiveCamera(this.camFov,this.renderer.width/this.renderer.height,this.camNear,this.camFar)}e=e||{},this.project=e.project,this.camFov=e.camFov||45,this.camNear=e.camNear||1,this.camFar=e.camFar||1e3,this.renderer=new t({project:this.project}),this.camera=n.bind(this)(),this.controls=void 0,this.Start=function(){this.renderer.Render()}}}]),angular.module("App").factory("Injector",["$q","$injector","paths","updater",function(t,e,n,i){return function(n){function o(t){return e.get(t)}function r(e){var n=t.defer(),i=[],o={};return _.each(e.meshes,function(t){var n=s.loader.LoadMesh(t);n.then(function(n){o[t]=n,e.add(n)}),i.push(n)}),t.all(i).then(function(){e.meshes=o,n.resolve(e)}),n.promise}function a(e){var n=t.defer(),r={};return _.each(e.components,function(t){var n=o(t);r[t]=new n(e),i.Add(r[t])}),e.components=r,n.resolve(),n.promise}this.loader=n;var s=this;this.LoadPrefab=function(e){var n=t.defer(),i=o(e),h=(new THREE.Object3D,new i);return h=_.extend(new THREE.Object3D,h),r(h).then(a).then(function(){h.loader=this.loader,n.resolve(h),h.Start(s.loader)}.bind(this)),n.promise},this.AddComponent=function(t,e){var n=o(e);t.components[e]=new n(t),i.Add(t.components[e])}}}]),angular.module("App").factory("Loader",["$q","Injector","paths","Prefab",function(t,e,n,i){return function(o){o=o||{},this.scene=new THREE.Scene,this.injector=new e(this);var r=new THREE.JSONLoader;this.LoadMesh=function(e){var o=t.defer();return r.load(n.models+"/"+e+".json",function(t,e){var n=new THREE.MultiMaterial(e),r=new THREE.Mesh(t,n);r.loader=this,r=_.extend(r,new i),o.resolve(r)}.bind(this)),o.promise},this.LoadPrefab=function(e){var n=t.defer();return this.injector.LoadPrefab(e).then(function(t){this.Add(t),n.resolve(t)}.bind(this)),n.promise},this.Add=function(t,e){e=e||this.scene,e.add(t)},this.Remove=function(t){this.scene.remove(t)}}}]),angular.module("App").factory("Renderer",["updater",function(t){return function(e){function n(t){try{var e=$("#"+t);if(0===e.length)throw"could not find container with ID "+t;return e}catch(n){console.error(n)}}function i(t,e){var n=new THREE.WebGLRenderer({antialias:!0});return n.setSize(t,e),$(this.container).append(n.domElement),n}e=e||{},this.project=e.project,this.container=n(e.containerID||"WebGL"),this.width=$(this.container).outerWidth(),this.height=$(this.container).outerHeight(),this.renderer=i.bind(this)(this.width,this.height);var o,r,a,s=0,h=60,c=1e3/h;this.Render=function(e){r=e-s,a=r/c,s=e,t.Update(a),this.renderer.render(this.project.loader.scene,this.project.animate.camera),o=requestAnimationFrame(this.Render.bind(this))}}}]),angular.module("App").factory("paths",[function(){return new function(){this.assets="./assets",this.js="./js",this.models=this.assets+"/models",this.prefabs=this.js+"/prefabs"}}]),angular.module("App").factory("updater",["$log",function(t){return{handlers:[],renderFunction:void 0,Add:function(t){this.handlers.push(t)},Remove:function(t){var e=this.handlers.indexOf(t);e>-1&&this.handlers.splice(e,1)},ReturnIndex:function(t){var e=this.handlers.indexOf(t);return e>-1&&e},Update:function(t){for(var e=0;e<this.handlers.length;e++)this.handlers[e].Update(t)},ClearAll:function(){this.handlers=[]}}}]),angular.module("App").factory("util",[function(){return new function(){this.Deg2Rad=function(t){return t*(Math.PI/180)},this.Rad2Deg=function(t){return t*(180/Math.PI)}}}]);